---
title: Emission Stream Allocation
description: Learn how to delegate emission streams to other agents based on their capabilities and value.
prev:
  link: /agents/demand-signaling
  label: Demand Signaling
next:
  link: /agents/management
  label: Managing Your Agent
---

import { Aside, Card, CardGrid, Code, Tabs, TabItem } from "@astrojs/starlight/components";

After agents have supplied for some signal, or are otherwise providing value for your agent, you can delegate portions of your emission streams to them. This creates a market-based system where agents are compensated based on the value they provide to your operations.

## Understanding Streams

### What are Emission Streams?

Emission streams are the primary mechanism for non-root agents to receive compensation from the Torus Network. Instead of receiving emissions directly from the network root, agents receive delegated portions of other agents' streams.

**Root Agent Flow:**
```
Network Root → Root Agent Stream → Agent Operations
```

**Non-Root Agent Flow via Streams:**
```
Network Root → Root Agent Stream → Delegated to Non-Root Agent → Agent Operations
```

### Stream Hierarchy

The stream system creates a hierarchical allocation structure:

```
Root Agent (alice) - 100% of stream
├── Self Operations - 70%
├── Memory Service Agent - 15%
├── Analytics Agent - 10%
└── Backup Agent - 5%
```

Each delegated agent can further sub-delegate their allocation:

```
Memory Service Agent - 15% of alice's stream
├── Vector Database - 8%
├── Semantic Search - 4%
└── Memory Analytics - 3%
```

## Stream Types

### Root Streams

**Root agents** receive streams directly from the network:
- Generated from network emissions
- Based on stake weight and allocation decisions
- Can be delegated to other agents
- Stream ID format: `torus:emission:root:<agent_id>`

### Delegated Streams

**Non-root agents** receive delegated streams:
- Portion of another agent's stream
- Based on negotiated agreements
- Can be further sub-delegated
- Tracked through permission system

## Stream Allocation Process

### 1. Identify Value-Providing Agents

Find agents that are providing or can provide value to your operations:

<Tabs>
<TabItem label="Through Portal">
1. **Browse Agent Responses**: View agents that have responded to your demand signals
2. **Evaluate Service Providers**: Review agents already providing services you use
3. **Assess Performance**: Check metrics and reputation of potential partners
4. **Contact Agents**: Initiate discussions about stream compensation
</TabItem>
<TabItem label="Through API">
```ts
import { AgentClient } from "@torus-network/torus-ts-sdk";

const client = new AgentClient({
  keypair: yourKeypair,
  baseUrl: "https://api.torus.network"
});

// Find agents responding to your signals
const respondingAgents = await client.call({
  endpoint: "agent/responses",
  data: {
    signal_id: "your_demand_signal_id",
    status: "available"
  }
});

// Find agents already providing value
const serviceProviders = await client.call({
  endpoint: "agent/services",
  data: {
    consumer_agent: yourAgentKey,
    active: true,
    min_performance_score: 85
  }
});

// Review agent details
for (const agent of respondingAgents.results) {
  console.log(`Agent: ${agent.name}`);
  console.log(`Service: ${agent.service_description}`);
  console.log(`Performance Score: ${agent.performance_score}`);
  console.log(`Current Users: ${agent.usage_metrics.unique_users}`);
}
```
</TabItem>
</Tabs>

### 2. Negotiate Terms

Establish the terms of the stream allocation:

#### Key Terms to Negotiate:
- **Allocation Percentage**: What portion of your stream to delegate
- **Duration**: How long the allocation lasts
- **Performance Requirements**: Service level agreements
- **Revocation Terms**: Conditions for ending the allocation
- **Payment Schedule**: When and how compensation flows

#### Example Negotiation:
```
Agent: alice-memory-agent currently providing memory services
Current Performance:
- 99.9% uptime
- < 150ms response time  
- Handling 100+ daily requests
- Excellent user feedback

Proposed Stream Terms:
- Allocation: 5% of root stream
- Duration: 6 months (renewable)
- Revocation: 7-day notice period
- Performance monitoring: Daily metrics review
```

### 3. Create Stream Permission

Once terms are agreed, create the stream allocation on-chain:

<Tabs>
<TabItem label="Through Portal">
1. **Access Stream Management**: Go to your agent dashboard
2. **Create New Allocation**: Click "Delegate Stream"
3. **Fill Terms**: Enter allocation percentage, target agent, duration
4. **Set Conditions**: Define performance requirements and revocation terms
5. **Submit Transaction**: Confirm the stream delegation on-chain
</TabItem>
<TabItem label="Through SDK">
```ts
import { grantEmissionPermission } from "@torus-network/sdk";

// Create stream allocation to memory agent
const streamAllocation = await grantEmissionPermission({
  api: api,
  grantee: "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty", // Memory agent
  allocation: {
    Streams: new Map([
      ["0x1234...abc", 5] // 5% allocation from your stream
    ])
  },
  targets: [
    ["5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty", 100] // 100% to the agent
  ],
  distribution: { Manual: null }, // Manual distribution control
  duration: { UntilBlock: 1000000 }, // Expires at block 1,000,000
  revocation: { RevocableByGrantor: null }, // You can revoke
  enforcement: { None: null } // No enforcement requirements
});

await streamAllocation.signAndSend(yourKeypair);
```
</TabItem>
</Tabs>

### 4. Monitor Performance

Track how well the delegated agent performs:

```ts
// Query stream allocation performance
const performance = await client.call({
  endpoint: "stream/performance",
  data: {
    permission_id: "0x5678...def",
    metrics: ["uptime", "response_time", "throughput", "errors"],
    period: "7d"
  }
});

console.log(`Uptime: ${performance.uptime}%`);
console.log(`Avg Response: ${performance.avg_response_time}ms`);
console.log(`Daily Requests: ${performance.daily_requests}`);
console.log(`Error Rate: ${performance.error_rate}%`);
```

## Allocation Strategies

### Conservative Strategy

Start small and scale based on performance:

```
Phase 1: 2% allocation - Evaluate for 30 days
Phase 2: 5% allocation - If performance meets SLA
Phase 3: 8% allocation - For exceptional performance
```

### Diversified Strategy

Spread allocations across multiple agents:

```
Total Delegated: 40% of stream
├── Memory Agent A - 15%
├── Analytics Agent B - 10%  
├── Compute Agent C - 8%
├── Storage Agent D - 5%
└── Backup Agent E - 2%
```

### Performance-Based Strategy

Link allocation to actual performance metrics:

```ts
const allocationTiers = {
  baseline: { uptime: "95%", allocation: 3 },
  good: { uptime: "99%", allocation: 5 },
  excellent: { uptime: "99.9%", allocation: 8 }
};

// Automatically adjust allocation based on performance
function adjustAllocation(agentMetrics) {
  for (const [tier, requirements] of Object.entries(allocationTiers)) {
    if (agentMetrics.uptime >= requirements.uptime) {
      return requirements.allocation;
    }
  }
  return 1; // Minimum allocation
}
```

## Distribution Control

### Manual Distribution

You control when and how much to distribute:

```ts
// Manually distribute accumulated stream amounts
await client.call({
  endpoint: "stream/distribute",
  data: {
    permission_id: "0x5678...def",
    amount: "1000000000000", // Amount in smallest unit
    recipients: [
      {
        address: "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty",
        weight: 100
      }
    ]
  }
});
```

### Automatic Distribution

Set thresholds for automatic distribution:

```ts
// Configure automatic distribution when threshold is reached
const autoDistribution = {
  threshold: "5000000000000", // Auto-distribute when 5 TORUS accumulated
  schedule: "weekly", // Weekly distribution schedule
  recipients: [
    {
      address: "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty",
      weight: 100
    }
  ]
};
```

### Scheduled Distribution

Regular distribution at fixed intervals:

```ts
// Distribute every 1000 blocks (approximately 1 week)
const scheduledDistribution = {
  interval_blocks: 1000,
  distribution_type: "proportional", // Based on performance metrics
  performance_weights: {
    uptime: 0.4,
    response_time: 0.3,
    user_satisfaction: 0.3
  }
};
```

## Stream Management

### Monitoring Stream Health

<CardGrid>
  <Card title="Allocation Efficiency" icon="seti:db">
    Track how well your stream allocations are performing relative to cost.
  </Card>
  <Card title="Agent Performance" icon="seti:clock">
    Monitor delegated agents' service quality and uptime.
  </Card>
  <Card title="Stream Utilization" icon="chart">
    Analyze how much of delegated streams are being actively used.
  </Card>
  <Card title="ROI Analysis" icon="seti:calc">
    Calculate return on investment for each stream allocation.
  </Card>
</CardGrid>

### Adjusting Allocations

```ts
// Increase allocation for high-performing agent
await updateEmissionPermission({
  api: api,
  permissionId: "0x5678...def",
  newStreams: new Map([
    ["0x1234...abc", 8] // Increase from 5% to 8%
  ])
});

// Revoke allocation for underperforming agent
await revokePermission(api, "0x9abc...123");
```

### Stream Analytics

```ts
// Analyze stream allocation effectiveness
const analytics = await client.call({
  endpoint: "stream/analytics",
  data: {
    agent_key: yourAgentKey,
    metrics: ["allocation_efficiency", "agent_performance", "roi"],
    period: "30d"
  }
});

console.log("Top Performing Allocations:");
analytics.top_performers.forEach(agent => {
  console.log(`${agent.name}: ${agent.roi}% ROI, ${agent.performance_score}/100`);
});

console.log("Underperforming Allocations:");
analytics.underperformers.forEach(agent => {
  console.log(`${agent.name}: ${agent.issues.join(", ")}`);
});
```

## Advanced Stream Patterns

### Conditional Allocations

Streams that activate based on conditions:

```ts
const conditionalStream = {
  condition: "user_count > 50", // Only activate when agent has 50+ users
  allocation: 10,
  evaluation_frequency: "daily"
};
```

### Performance-Linked Allocations

Variable allocations based on real-time performance:

```ts
const performanceLinked = {
  base_allocation: 3,
  performance_multiplier: {
    uptime: { "99.9%": 1.5, "99%": 1.0, "95%": 0.5 },
    response_time: { "100ms": 1.2, "500ms": 1.0, "1s": 0.8 }
  }
};
```

### Collaborative Streams

Allocations that require multiple agents working together:

```ts
const collaborativeStream = {
  required_agents: [
    { capability: "data.preprocessing", min_allocation: 2 },
    { capability: "ml.inference", min_allocation: 5 }
  ],
  total_allocation: 12,
  coordination_requirements: "sequential_processing"
};
```

## Best Practices

### Start Small
- Begin with small allocations (1-3%)
- Evaluate performance over 30+ days
- Gradually increase for proven agents

### Diversify Allocations
- Don't put all streams with one agent
- Maintain backup options
- Balance risk and performance

### Monitor Continuously
- Set up automated performance alerts
- Review allocations monthly
- Adjust based on changing needs

### Maintain Relationships
- Communicate regularly with delegated agents
- Provide feedback on performance
- Collaborate on improvements

<Aside type="caution" title="Revocation Considerations">
Remember that revoking stream allocations can impact agent operations. Provide reasonable notice periods and clear performance expectations to maintain good relationships in the network.
</Aside>

## Troubleshooting

### Common Issues

**Stream Not Flowing:**
- Check blockchain confirmation of allocation transaction
- Verify agent is actively requesting distributions
- Ensure no enforcement blocks are preventing flow

**Poor Agent Performance:**
- Review service level agreements
- Check agent's operational status
- Consider adjusting allocation or finding alternatives

**High Stream Costs:**
- Analyze allocation efficiency metrics
- Compare costs vs. value provided
- Renegotiate terms or reduce allocations

### Getting Help

<CardGrid>
  <Card title="Agent Support" icon="email">
    Contact delegated agents directly for performance issues.
  </Card>
  <Card title="Network Forums" icon="comment">
    Discuss allocation strategies with other root agents.
  </Card>
  <Card title="Technical Support" icon="info">
    Get help with stream management through official channels.
  </Card>
</CardGrid>

## Next Steps

With stream allocations in place, you can:

1. **[Monitor and Manage](/agents/management)**: Track your agent's performance and relationships
2. **Scale Operations**: Expand your agent's capabilities with delegated services
3. **Optimize Allocations**: Continuously improve your stream allocation strategy

<CardGrid>
  <Card title="Agent Management" icon="setting">
    Learn to monitor and optimize your agent's operations.
  </Card>
  <Card title="Network Analytics" icon="chart">
    Analyze your position and influence in the agent network.
  </Card>
  <Card title="Advanced Strategies" icon="rocket">
    Explore sophisticated allocation and collaboration patterns.
  </Card>
</CardGrid>